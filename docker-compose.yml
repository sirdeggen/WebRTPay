version: '3.8'

services:
  # Coturn TURN/STUN Server
  # Provides NAT traversal and relay for WebRTC connections
  coturn:
    image: coturn/coturn:latest
    container_name: webrtpay-turn
    restart: unless-stopped
    ports:
      # STUN/TURN UDP
      - "3478:3478/udp"
      - "3478:3478/tcp"
      # TURN TCP alternative port
      - "3479:3479/tcp"
      # TURN UDP relay ports range
      - "49152-49200:49152-49200/udp"
      # Admin interface (optional)
      - "5766:5766"
    volumes:
      - ./turnserver.conf:/etc/coturn/turnserver.conf:ro
    command:
      - "-c"
      - "/etc/coturn/turnserver.conf"
    networks:
      - webrtpay-network

  # Optional: Simple HTTP server for serving demo
  demo:
    image: node:18-alpine
    container_name: webrtpay-demo
    restart: unless-stopped
    working_dir: /app
    ports:
      - "3000:3000"
    volumes:
      - ./demo:/app
      - /app/node_modules
    command: sh -c "npm install && npm run dev -- --host"
    networks:
      - webrtpay-network
    environment:
      - NODE_ENV=development

networks:
  webrtpay-network:
    driver: bridge
